name: Update Fancy Clock

on:
  schedule:
    - cron: "*/5 * * * *"

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Generate Clock SVG
        run: |
          # Chicago local time
          H=$(TZ="America/Chicago" date +"%H")
          M=$(TZ="America/Chicago" date +"%M")
          S=$(TZ="America/Chicago" date +"%S")

          # Convert to clock angles
          H_ANGLE=$(( (H % 12) * 30 + M / 2 ))
          M_ANGLE=$(( M * 6 ))
          S_ANGLE=$(( S * 6 ))

          # Create SVG
          sed \
            -e "s/HOUR_ANGLE/$H_ANGLE/" \
            -e "s/MIN_ANGLE/$M_ANGLE/" \
            -e "s/SEC_ANGLE/$S_ANGLE/" \
            clock.svg.template > clock.svg

      - name: Commit

        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add clock.svg
          git commit -m "Update clock" || exit 0
          git pull --rebase
          git push
